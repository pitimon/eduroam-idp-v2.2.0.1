# eduroam-idp v2.2.0.1

## รายละเอียด
โปรแกรมนี้รวบรวมเหตุการณ์ Access-Accept สำหรับผู้ใช้จากโดเมนที่ระบุโดยใช้ความสามารถในการรวบรวมของ Quickwit search engine โดยเก็บข้อมูลในช่วงเวลาที่ระบุ ประมวลผลผลลัพธ์ และส่งออกข้อมูลที่รวบรวมไว้ไปยังไฟล์ JSON

## การติดตั้ง

### วิธีที่ 1: ติดตั้งแบบดั้งเดิม
1. ติดตั้ง Go (เวอร์ชัน 1.18 หรือใหม่กว่า)
2. Clone โปรเจ็กต์
3. สร้างไฟล์ `qw-auth.properties` จากเทมเพลต
4. คอมไพล์โปรแกรม:
   ```bash
   go build -o eduroam-idp
   ```

### วิธีที่ 2: ใช้ Docker
1. สร้างไฟล์ `qw-auth.properties` จากเทมเพลต
2. สร้าง Docker image:
   ```bash
   docker build -t eduroam-idp:2.2.0.1 .
   ```
3. รันโปรแกรมด้วย Docker:
   ```bash
   docker run -v $(pwd)/output:/app/output -v $(pwd)/qw-auth.properties:/app/qw-auth.properties eduroam-idp:2.2.0.1 example.ac.th 7
   ```

## การใช้งาน
```
./eduroam-idp <domain> [days|Ny|DD-MM-YYYY]
```

พารามิเตอร์:
- `<domain>`: โดเมนที่ต้องการค้นหา (เช่น 'example.ac.th' หรือ 'etlr1' หรือ 'etlr2')
- `[days]`: ตัวเลือก จำนวนวัน (1-3650) ที่ต้องการย้อนหลังจากวันปัจจุบัน
- `[Ny]`: ตัวเลือก จำนวนปี (1y-10y) ที่ต้องการย้อนหลังจากวันปัจจุบัน
- `[DD-MM-YYYY]`: ตัวเลือก วันที่เฉพาะที่ต้องการประมวลผลข้อมูล

ตัวอย่าง:
```bash
# ค้นหาข้อมูลจาก example.ac.th ย้อนหลัง 7 วัน
./eduroam-idp example.ac.th 7

# ค้นหาข้อมูลจาก etlr1 ย้อนหลัง 1 ปี
./eduroam-idp etlr1 1y

# ค้นหาข้อมูลจาก etlr2 ในวันที่ 01-01-2024
./eduroam-idp etlr2 01-01-2024
```

## ตัวแปรสภาพแวดล้อม
- `NUM_WORKERS`: กำหนดจำนวน worker ที่ทำงานพร้อมกัน (ค่าเริ่มต้น: 10)
- `DEBUG`: เมื่อกำหนดเป็นค่าใดๆ จะแสดงข้อมูล debug เพิ่มเติม

## การคอนฟิก
ไฟล์ `qw-auth.properties` ต้องมีค่าต่อไปนี้:
```
QW_USER=username
QW_PASS=password
QW_URL=https://your-quickwit-server
```

## ผลลัพธ์
ผลลัพธ์จะถูกบันทึกในไดเร็กทอรี `output/<domain>/` เป็นไฟล์ JSON ที่มีข้อมูลดังนี้:
- ข้อมูลการค้นหา (โดเมน, จำนวนวัน, วันที่เริ่มต้น, วันที่สิ้นสุด)
- คำอธิบาย
- สรุป (จำนวนผู้ใช้ทั้งหมด, จำนวนผู้ให้บริการทั้งหมด)
- สถิติผู้ให้บริการ (รายชื่อผู้ให้บริการ, จำนวนผู้ใช้, รายชื่อผู้ใช้)
- สถิติผู้ใช้ (รายชื่อผู้ใช้, รายชื่อผู้ให้บริการ)

## การปรับปรุงในเวอร์ชัน 2.2.0.1
- เพิ่มการใช้ context.Context สำหรับการจัดการการยกเลิกและการหมดเวลา
- กำหนดค่าคงที่สำหรับค่าที่ใช้บ่อย
- ทำให้จำนวน worker ปรับแต่งได้ผ่านตัวแปรสภาพแวดล้อม
- ปรับปรุงการจัดการการเชื่อมต่อ HTTP ด้วยการตั้งค่าเวลาหมดเวลาที่เหมาะสม
- เพิ่มการจัดการข้อผิดพลาดและข้อความข้อผิดพลาดที่ละเอียดขึ้น
- ปรับปรุงการบันทึกด้วยระดับการบันทึก
- เพิ่มเอกสารประกอบฟังก์ชันในรูปแบบ GoDoc
- เพิ่มการปิดอย่างสง่างามด้วยการจัดการสัญญาณ
- รองรับการทำงานบน Docker

## ลิขสิทธิ์
[P.Itarun]